module.exports=[30410,a=>{"use strict";let b=(0,a.i(57961).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/TierList.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/TierList.tsx <module evaluation>","default");a.s(["default",0,b])},66473,a=>{"use strict";let b=(0,a.i(57961).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/TierList.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/TierList.tsx","default");a.s(["default",0,b])},17966,a=>{"use strict";a.i(30410);var b=a.i(66473);a.n(b)},60168,a=>{"use strict";let b,c;var d,e=a.i(26806),f=a.i(17966);let g=Symbol.for("__cloudflare-context__");function h(){return globalThis[g]}async function i(){let a=h();if(a)return a;{var b;let a=await j();return b=a,globalThis[g]=b,a}}async function j(a){let{getPlatformProxy:b}=await import(`${"__wrangler".replaceAll("_","")}`),c=a?.environment??process.env.NEXT_DEV_WRANGLER_ENV,{env:d,cf:e,ctx:f}=await b({...a,envFiles:[],environment:c});return{env:d,cf:e,ctx:f}}let k=Symbol.for("drizzle:entityKind");function l(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,k))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(k in c&&c[k]===b[k])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class m{static [k]="ConsoleLogWriter";write(a){console.log(a)}}class n{static [k]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new m}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class o{static [k]="NoopLogger";logQuery(){}}let p=Symbol.for("drizzle:Name"),q=Symbol.for("drizzle:Schema"),r=Symbol.for("drizzle:Columns"),s=Symbol.for("drizzle:ExtraConfigColumns"),t=Symbol.for("drizzle:OriginalName"),u=Symbol.for("drizzle:BaseName"),v=Symbol.for("drizzle:IsAlias"),w=Symbol.for("drizzle:ExtraConfigBuilder"),x=Symbol.for("drizzle:IsDrizzleTable");class y{static [k]="Table";static Symbol={Name:p,Schema:q,OriginalName:t,Columns:r,ExtraConfigColumns:s,BaseName:u,IsAlias:v,ExtraConfigBuilder:w};[p];[t];[q];[r];[s];[u];[v]=!1;[x]=!0;[w]=void 0;constructor(a,b,c){this[p]=this[t]=a,this[q]=b,this[u]=c}}function z(a){return`${a[q]??"public"}.${a[p]}`}class A{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [k]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}class B{static [k]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}class C{static [k]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new D(a,this)}}class D{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [k]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[p],...d,c[0].table[p],...e];return a??`${f.join("_")}_fk`}}function E(a,...b){return a(...b)}function F(a,b){return`${a[p]}_${b.join("_")}_unique`}class G{constructor(a,b){this.name=b,this.columns=a}static [k]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new I(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class H{static [k]="PgUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new G(a,this.name)}}class I{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??F(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [k]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function J(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class K extends B{foreignKeyConfigs=[];static [k]="PgColumnBuilder";array(a){return new O(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>E((c,d)=>{let e=new C(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new M(a,this.config)}}class L extends A{constructor(a,b){b.uniqueName||(b.uniqueName=F(a,[b.name])),super(a,b),this.table=a}static [k]="PgColumn"}class M extends L{static [k]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class N{static [k]="IndexedColumn";constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class O extends K{static [k]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new P(a,this.config,b)}}class P extends L{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [k]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=J(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=J(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:l(this.baseColumn,P)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class Q extends K{static [k]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new R(a,this.config)}}class R extends L{static [k]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let S=Symbol.for("drizzle:isPgEnum");class T extends K{static [k]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new U(a,this.config)}}class U extends L{static [k]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}class V{static [k]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class W extends V{static [k]="WithSubquery"}let X=(a,d)=>b?(c||(c=b.trace.getTracer("drizzle-orm","0.45.0")),E((b,c)=>c.startActiveSpan(a,a=>{try{return d(a)}catch(c){throw a.setStatus({code:b.SpanStatusCode.ERROR,message:c instanceof Error?c.message:"Unknown error"}),c}finally{a.end()}}),b,c)):d(),Y=Symbol.for("drizzle:ViewBaseConfig");class Z{static [k]="FakePrimitiveParam"}function $(a){return null!=a&&"function"==typeof a.getSQL}class _{static [k]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new aa([this])}}class aa{constructor(a){for(const b of(this.queryChunks=a,a))if(l(b,y)){const a=b[y.Symbol.Schema];this.usedTables.push(void 0===a?b[y.Symbol.Name]:a+"."+b[y.Symbol.Name])}}static [k]="SQL";decoder=ac;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return X("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:e,escapeParam:f,prepareTyping:g,inlineParams:h,paramStartIndex:i}=c;var j=a.map(a=>{if(l(a,_))return{sql:a.value.join(""),params:[]};if(l(a,ab))return{sql:e(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new _("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new _(", "));return b.push(new _(")")),this.buildQueryFromSourceParams(b,c)}if(l(a,aa))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:h||a.shouldInlineParams});if(l(a,y)){let b=a[y.Symbol.Schema],c=a[y.Symbol.Name];return{sql:void 0===b||a[v]?e(c):e(b)+"."+e(c),params:[]}}if(l(a,A)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:e(c),params:[]};let f=a.table[y.Symbol.Schema];return{sql:a.table[v]||void 0===f?e(a.table[y.Symbol.Name])+"."+e(c):e(f)+"."+e(a.table[y.Symbol.Name])+"."+e(c),params:[]}}if(l(a,al)){let b=a[Y].schema,c=a[Y].name;return{sql:void 0===b||a[Y].isAlias?e(c):e(b)+"."+e(c),params:[]}}if(l(a,ae)){if(l(a.value,ai))return{sql:f(i.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if(l(b,aa))return this.buildQueryFromSourceParams([b],c);if(h)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return g&&(d=[g(a.encoder)]),{sql:f(i.value++,b),params:[b],typings:d}}return l(a,ai)?{sql:f(i.value++,a),params:[a],typings:["none"]}:l(a,aa.Aliased)&&void 0!==a.fieldAlias?{sql:e(a.fieldAlias),params:[]}:l(a,V)?a._.isWith?{sql:e(a._.alias),params:[]}:this.buildQueryFromSourceParams([new _("("),a._.sql,new _(") "),new ab(a._.alias)],c):a&&"function"==typeof a&&S in a&&!0===a[S]?a.schema?{sql:e(a.schema)+"."+e(a.enumName),params:[]}:{sql:e(a.enumName),params:[]}:$(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new _("("),a.getSQL(),new _(")")],c):h?{sql:this.mapInlineParam(a,c),params:[]}:{sql:f(i.value++,a),params:[a],typings:["none"]}});let k={sql:"",params:[]};for(let a of j)k.sql+=a.sql,k.params.push(...a.params),a.typings?.length&&(k.typings||(k.typings=[]),k.typings.push(...a.typings));return k}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new aa.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class ab{constructor(a){this.value=a}static [k]="Name";brand;getSQL(){return new aa([this])}}let ac={mapFromDriverValue:a=>a},ad={mapToDriverValue:a=>a};({...ac,...ad});class ae{constructor(a,b=ad){this.value=a,this.encoder=b}static [k]="Param";brand;getSQL(){return new aa([this])}}function af(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new _(a[0])),b.entries()))c.push(e,new _(a[d+1]));return new aa(c)}(d=af||(af={})).empty=function(){return new aa([])},d.fromList=function(a){return new aa(a)},d.raw=function(a){return new aa([new _(a)])},d.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new aa(c)},d.identifier=function(a){return new ab(a)},d.placeholder=function(a){return new ai(a)},d.param=function(a,b){return new ae(a,b)};var ag=aa||(aa={});class ah{constructor(a,b){this.sql=a,this.fieldAlias=b}static [k]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new ah(this.sql,this.fieldAlias)}}ag.Aliased=ah;class ai{constructor(a){this.name=a}static [k]="Placeholder";getSQL(){return new aa([this])}}function aj(a,b){return a.map(a=>{if(l(a,ai)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if(l(a,ae)&&l(a.value,ai)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let ak=Symbol.for("drizzle:IsDrizzleView");class al{static [k]="View";[Y];[ak]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[Y]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new aa([this])}}function am(a,b,c){let d={},e=a.reduce((a,{path:e,field:f},g)=>{let h;h=l(f,A)?f:l(f,aa)?f.decoder:l(f,V)?f._.sql.decoder:f.sql.decoder;let i=a;for(let[a,j]of e.entries())if(a<e.length-1)j in i||(i[j]={}),i=i[j];else{let a=b[g],k=i[j]=null===a?null:h.mapFromDriverValue(a);if(c&&l(f,A)&&2===e.length){let a=e[0];a in d?"string"==typeof d[a]&&d[a]!==f.table[p]&&(d[a]=!1):d[a]=null===k&&f.table[p]}}return a},{});if(c&&Object.keys(d).length>0)for(let[a,b]of Object.entries(d))"string"!=typeof b||c[b]||(e[a]=null);return e}function an(a,b){return Object.entries(a).reduce((a,[c,d])=>{if("string"!=typeof c)return a;let e=b?[...b,c]:[c];return l(d,A)||l(d,aa)||l(d,aa.Aliased)||l(d,V)?a.push({path:e,field:d}):l(d,y)?a.push(...an(d[y.Symbol.Columns],e)):a.push(...an(d,e)),a},[])}function ao(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function ap(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>l(c,aa)||l(c,A)?[b,c]:[b,new ae(c,a[y.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function aq(a){return l(a,V)?a._.alias:l(a,al)?a[Y].name:l(a,aa)?void 0:a[y.Symbol.IsAlias]?a[y.Symbol.Name]:a[y.Symbol.BaseName]}function ar(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}A.prototype.getSQL=function(){return new aa([this])},y.prototype.getSQL=function(){return new aa([this])},V.prototype.getSQL=function(){return new aa([this])};let as="undefined"==typeof TextDecoder?null:new TextDecoder;class at extends K{static [k]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class au extends at{static [k]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new av(a,this.config)}}class av extends L{static [k]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class aw extends at{static [k]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new ax(a,this.config)}}class ax extends L{static [k]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}class ay extends K{static [k]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new az(a,this.config)}}class az extends L{static [k]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class aA extends K{static [k]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new aB(a,this.config)}}class aB extends L{static [k]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}class aC extends K{static [k]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new aD(a,this.config)}}class aD extends L{static [k]="PgBoolean";getSQLType(){return"boolean"}}class aE extends K{static [k]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new aF(a,this.config)}}class aF extends L{static [k]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}class aG extends K{static [k]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new aH(a,this.config)}}class aH extends L{static [k]="PgCidr";getSQLType(){return"cidr"}}class aI extends K{static [k]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new aJ(a,this.config)}}class aJ extends L{static [k]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}class aK extends K{static [k]="PgDateColumnBaseBuilder";defaultNow(){return this.default(af`now()`)}}class aL extends aK{static [k]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new aM(a,this.config)}}class aM extends L{static [k]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?new Date(a):a}mapToDriverValue(a){return a.toISOString()}}class aN extends aK{static [k]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new aO(a,this.config)}}class aO extends L{static [k]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?a:a.toISOString().slice(0,-14)}}class aP extends K{static [k]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new aQ(a,this.config)}}class aQ extends L{static [k]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}class aR extends K{static [k]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new aS(a,this.config)}}class aS extends L{static [k]="PgInet";getSQLType(){return"inet"}}class aT extends at{static [k]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new aU(a,this.config)}}class aU extends L{static [k]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}class aV extends K{static [k]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new aW(a,this.config)}}class aW extends L{static [k]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}class aX extends K{static [k]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new aY(a,this.config)}}class aY extends L{static [k]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}class aZ extends K{static [k]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new a$(a,this.config)}}class a$ extends L{static [k]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}class a_ extends K{static [k]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new a0(a,this.config)}}class a0 extends L{static [k]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class a1 extends K{static [k]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new a2(a,this.config)}}class a2 extends L{static [k]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}class a3 extends K{static [k]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new a4(a,this.config)}}class a4 extends L{static [k]="PgMacaddr";getSQLType(){return"macaddr"}}class a5 extends K{static [k]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new a6(a,this.config)}}class a6 extends L{static [k]="PgMacaddr8";getSQLType(){return"macaddr8"}}class a7 extends K{static [k]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new a8(a,this.config)}}class a8 extends L{static [k]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class a9 extends K{static [k]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new ba(a,this.config)}}class ba extends L{static [k]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class bb extends K{static [k]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new bc(a,this.config)}}class bc extends L{static [k]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class bd extends K{static [k]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new be(a,this.config)}}class be extends L{static [k]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class bf extends K{static [k]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new bg(a,this.config)}}class bg extends L{static [k]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function bh(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function bi(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=bh(b,c),d=bh(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class bj extends K{static [k]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new bk(a,this.config)}}class bk extends L{static [k]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return bi(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class bl extends K{static [k]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new bm(a,this.config)}}class bm extends L{static [k]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=bi(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}class bn extends K{static [k]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new bo(a,this.config)}}class bo extends L{static [k]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}class bp extends K{static [k]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new bq(a,this.config)}}class bq extends L{static [k]="PgSerial";getSQLType(){return"serial"}}class br extends at{static [k]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new bs(a,this.config)}}class bs extends L{static [k]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}class bt extends K{static [k]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new bu(a,this.config)}}class bu extends L{static [k]="PgSmallSerial";getSQLType(){return"smallserial"}}class bv extends K{static [k]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new bw(a,this.config)}}class bw extends L{static [k]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}class bx extends aK{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [k]="PgTimeBuilder";build(a){return new by(a,this.config)}}class by extends L{static [k]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}class bz extends aK{static [k]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new bA(a,this.config)}}class bA extends L{static [k]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){return"string"==typeof a?new Date(this.withTimezone?a:a+"+0000"):a}mapToDriverValue=a=>a.toISOString()}class bB extends aK{static [k]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new bC(a,this.config)}}class bC extends L{static [k]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){if("string"==typeof a)return a;let b=a.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let c=a.getTimezoneOffset();return`${b}${c<=0?"+":"-"}${Math.floor(Math.abs(c)/60).toString().padStart(2,"0")}`}return b}}class bD extends K{static [k]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(af`gen_random_uuid()`)}build(a){return new bE(a,this.config)}}class bE extends L{static [k]="PgUUID";getSQLType(){return"uuid"}}class bF extends K{static [k]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new bG(a,this.config)}}class bG extends L{static [k]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}class bH extends K{static [k]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new bI(a,this.config)}}class bI extends L{static [k]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}class bJ extends K{static [k]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new bK(a,this.config)}}class bK extends L{static [k]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}class bL extends K{static [k]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new bM(a,this.config)}}class bM extends L{static [k]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}class bN extends K{static [k]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new bO(a,this.config)}}class bO extends L{static [k]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}let bP=Symbol.for("drizzle:PgInlineForeignKeys"),bQ=Symbol.for("drizzle:EnableRLS");class bR extends y{static [k]="PgTable";static Symbol=Object.assign({},y.Symbol,{InlineForeignKeys:bP,EnableRLS:bQ});[bP]=[];[bQ]=!1;[y.Symbol.ExtraConfigBuilder]=void 0;[y.Symbol.ExtraConfigColumns]={}}class bS{static [k]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new bT(a,this.columns,this.name)}}class bT{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [k]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[bR.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}function bU(a,b){return"object"!=typeof b||null===b||!("mapToDriverValue"in b)||"function"!=typeof b.mapToDriverValue||$(a)||l(a,ae)||l(a,ai)||l(a,A)||l(a,y)||l(a,al)?a:new ae(a,b)}let bV=(a,b)=>af`${a} = ${bU(b,a)}`,bW=(a,b)=>af`${a} <> ${bU(b,a)}`;function bX(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new aa(1===b.length?b:[new _("("),af.join(b,new _(" and ")),new _(")")])}function bY(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new aa(1===b.length?b:[new _("("),af.join(b,new _(" or ")),new _(")")])}function bZ(a){return af`not ${a}`}let b$=(a,b)=>af`${a} > ${bU(b,a)}`,b_=(a,b)=>af`${a} >= ${bU(b,a)}`,b0=(a,b)=>af`${a} < ${bU(b,a)}`,b1=(a,b)=>af`${a} <= ${bU(b,a)}`;function b2(a,b){return Array.isArray(b)?0===b.length?af`false`:af`${a} in ${b.map(b=>bU(b,a))}`:af`${a} in ${bU(b,a)}`}function b3(a,b){return Array.isArray(b)?0===b.length?af`true`:af`${a} not in ${b.map(b=>bU(b,a))}`:af`${a} not in ${bU(b,a)}`}function b4(a){return af`${a} is null`}function b5(a){return af`${a} is not null`}function b6(a){return af`exists ${a}`}function b7(a){return af`not exists ${a}`}function b8(a,b,c){return af`${a} between ${bU(b,a)} and ${bU(c,a)}`}function b9(a,b,c){return af`${a} not between ${bU(b,a)} and ${bU(c,a)}`}function ca(a,b){return af`${a} like ${b}`}function cb(a,b){return af`${a} not like ${b}`}function cc(a,b){return af`${a} ilike ${b}`}function cd(a,b){return af`${a} not ilike ${b}`}function ce(a){return af`${a} asc`}function cf(a){return af`${a} desc`}class cg{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[y.Symbol.Name]}static [k]="Relation";referencedTableName;fieldName}class ch{constructor(a,b){this.table=a,this.config=b}static [k]="Relations"}class ci extends cg{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [k]="One";withFieldName(a){let b=new ci(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class cj extends cg{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [k]="Many";withFieldName(a){let b=new cj(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function ck(a){return{one:function(b,c){return new ci(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new cj(a,b,c)}}}class cl{constructor(a){this.table=a}static [k]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class cm{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [k]="TableAliasProxyHandler";get(a,b){if(b===y.Symbol.IsAlias)return!0;if(b===y.Symbol.Name||this.replaceOriginalName&&b===y.Symbol.OriginalName)return this.alias;if(b===Y)return{...a[Y],name:this.alias,isAlias:!0};if(b===y.Symbol.Columns){let b=a[y.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new cl(new Proxy(a,this)))}),c}let c=a[b];return l(c,A)?new Proxy(c,new cl(new Proxy(a,this))):c}}class cn{constructor(a){this.alias=a}static [k]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?co(a.sourceTable,this.alias):a[b]}}function co(a,b){return new Proxy(a,new cm(b,!1))}function cp(a,b){return new Proxy(a,new cl(new Proxy(a.table,new cm(b,!1))))}function cq(a,b){return new aa.Aliased(cr(a.sql,b),a.fieldAlias)}function cr(a,b){return af.join(a.queryChunks.map(a=>l(a,A)?cp(a,b):l(a,aa)?cr(a,b):l(a,aa.Aliased)?cq(a,b):a))}class cs{static [k]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===Y)return{...a[Y],selectedFields:new Proxy(a[Y].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=(l(a,V)?a._.selectedFields:l(a,al)?a[Y].selectedFields:a)[b];if(l(c,aa.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if(l(c,aa)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return l(c,A)?this.config.alias?new Proxy(c,new cl(new Proxy(c.table,new cm(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new cs(this.config))}}function ct(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function cu(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function cv(a){return a}class cw{static [k]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?ct:"camelCase"===a?cu:cv}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[y.Symbol.Schema]??"public",c=a.table[y.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[y.Symbol.Schema]??"public",c=a[y.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[y.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class cx extends Error{static [k]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class cy extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,cy),c&&(this.cause=c)}}class cz extends cx{static [k]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class cA{static [k]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=a,this}onDelete(a){return this._onDelete=a,this}build(a){return new cB(a,this)}}class cB{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [k]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[p],...d,c[0].table[p],...e];return a??`${f.join("_")}_fk`}}function cC(a,b){return`${a[p]}_${b.join("_")}_unique`}class cD{constructor(a,b){this.name=b,this.columns=a}static [k]="SQLiteUniqueConstraintBuilder";columns;build(a){return new cF(a,this.columns,this.name)}}class cE{static [k]="SQLiteUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new cD(a,this.name)}}class cF{constructor(a,b,c){this.table=a,this.columns=b,this.name=c??cC(this.table,this.columns.map(a=>a.name))}static [k]="SQLiteUniqueConstraint";columns;name;getName(){return this.name}}class cG extends B{static [k]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a){return this.config.isUnique=!0,this.config.uniqueName=a,this}generatedAlwaysAs(a,b){return this.config.generated={as:a,type:"always",mode:b?.mode??"virtual"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>{let e;return e=new cA(()=>({columns:[a],foreignColumns:[c()]})),d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)})}}class cH extends A{constructor(a,b){b.uniqueName||(b.uniqueName=cC(a,[b.name])),super(a,b),this.table=a}static [k]="SQLiteColumn"}class cI extends cG{static [k]="SQLiteBigIntBuilder";constructor(a){super(a,"bigint","SQLiteBigInt")}build(a){return new cJ(a,this.config)}}class cJ extends cH{static [k]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?BigInt((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):BigInt(as.decode(a))}mapToDriverValue(a){return Buffer.from(a.toString())}}class cK extends cG{static [k]="SQLiteBlobJsonBuilder";constructor(a){super(a,"json","SQLiteBlobJson")}build(a){return new cL(a,this.config)}}class cL extends cH{static [k]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?JSON.parse((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):JSON.parse(as.decode(a))}mapToDriverValue(a){return Buffer.from(JSON.stringify(a))}}class cM extends cG{static [k]="SQLiteBlobBufferBuilder";constructor(a){super(a,"buffer","SQLiteBlobBuffer")}build(a){return new cN(a,this.config)}}class cN extends cH{static [k]="SQLiteBlobBuffer";mapFromDriverValue(a){return Buffer.isBuffer(a)?a:Buffer.from(a)}getSQLType(){return"blob"}}function cO(a,b){let{name:c,config:d}=ar(a,b);return d?.mode==="json"?new cK(c):d?.mode==="bigint"?new cI(c):new cM(c)}class cP extends cG{static [k]="SQLiteCustomColumnBuilder";constructor(a,b,c){super(a,"custom","SQLiteCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new cQ(a,this.config)}}class cQ extends cH{static [k]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function cR(a){return(b,c)=>{let{name:d,config:e}=ar(b,c);return new cP(d,e,a)}}class cS extends cG{static [k]="SQLiteBaseIntegerBuilder";constructor(a,b,c){super(a,b,c),this.config.autoIncrement=!1}primaryKey(a){return a?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class cT extends cH{static [k]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class cU extends cS{static [k]="SQLiteIntegerBuilder";constructor(a){super(a,"number","SQLiteInteger")}build(a){return new cV(a,this.config)}}class cV extends cT{static [k]="SQLiteInteger"}class cW extends cS{static [k]="SQLiteTimestampBuilder";constructor(a,b){super(a,"date","SQLiteTimestamp"),this.config.mode=b}defaultNow(){return this.default(af`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(a){return new cX(a,this.config)}}class cX extends cT{static [k]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(a){return new Date("timestamp"===this.config.mode?1e3*a:a)}mapToDriverValue(a){let b=a.getTime();return"timestamp"===this.config.mode?Math.floor(b/1e3):b}}class cY extends cS{static [k]="SQLiteBooleanBuilder";constructor(a,b){super(a,"boolean","SQLiteBoolean"),this.config.mode=b}build(a){return new cZ(a,this.config)}}class cZ extends cT{static [k]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(a){return 1===Number(a)}mapToDriverValue(a){return+!!a}}function c$(a,b){let{name:c,config:d}=ar(a,b);return d?.mode==="timestamp"||d?.mode==="timestamp_ms"?new cW(c,d.mode):d?.mode==="boolean"?new cY(c,d.mode):new cU(c)}class c_ extends cG{static [k]="SQLiteNumericBuilder";constructor(a){super(a,"string","SQLiteNumeric")}build(a){return new c0(a,this.config)}}class c0 extends cH{static [k]="SQLiteNumeric";mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return"numeric"}}class c1 extends cG{static [k]="SQLiteNumericNumberBuilder";constructor(a){super(a,"number","SQLiteNumericNumber")}build(a){return new c2(a,this.config)}}class c2 extends cH{static [k]="SQLiteNumericNumber";mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return"numeric"}}class c3 extends cG{static [k]="SQLiteNumericBigIntBuilder";constructor(a){super(a,"bigint","SQLiteNumericBigInt")}build(a){return new c4(a,this.config)}}class c4 extends cH{static [k]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function c5(a,b){let{name:c,config:d}=ar(a,b),e=d?.mode;return"number"===e?new c1(c):"bigint"===e?new c3(c):new c_(c)}class c6 extends cG{static [k]="SQLiteRealBuilder";constructor(a){super(a,"number","SQLiteReal")}build(a){return new c7(a,this.config)}}class c7 extends cH{static [k]="SQLiteReal";getSQLType(){return"real"}}function c8(a){return new c6(a??"")}class c9 extends cG{static [k]="SQLiteTextBuilder";constructor(a,b){super(a,"string","SQLiteText"),this.config.enumValues=b.enum,this.config.length=b.length}build(a){return new da(a,this.config)}}class da extends cH{static [k]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(a,b){super(a,b)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class db extends cG{static [k]="SQLiteTextJsonBuilder";constructor(a){super(a,"json","SQLiteTextJson")}build(a){return new dc(a,this.config)}}class dc extends cH{static [k]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(a){return JSON.parse(a)}mapToDriverValue(a){return JSON.stringify(a)}}function dd(a,b={}){let{name:c,config:d}=ar(a,b);return"json"===d.mode?new db(c):new c9(c,d)}let de=Symbol.for("drizzle:SQLiteInlineForeignKeys");class df extends y{static [k]="SQLiteTable";static Symbol=Object.assign({},y.Symbol,{InlineForeignKeys:de});[y.Symbol.Columns];[de]=[];[y.Symbol.ExtraConfigBuilder]=void 0}let dg=(a,b,c)=>(function(a,b,c,d,e=a){let f=new df(a,void 0,e),g=Object.fromEntries(Object.entries("function"==typeof b?b({blob:cO,customType:cR,integer:c$,numeric:c5,real:c8,text:dd}):b).map(([a,b])=>{b.setName(a);let c=b.build(f);return f[de].push(...b.buildForeignKeys(c,f)),[a,c]})),h=Object.assign(f,g);return h[y.Symbol.Columns]=g,h[y.Symbol.ExtraConfigColumns]=g,c&&(h[df.Symbol.ExtraConfigBuilder]=c),h})(a,b,c);class dh extends al{static [k]="SQLiteViewBase"}class di{static [k]="SQLiteDialect";casing;constructor(a){this.casing=new cw(a?.casing)}escapeName(a){return`"${a}"`}escapeParam(a){return"?"}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[af`with `];for(let[c,d]of a.entries())b.push(af`${af.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push(af`, `);return b.push(af` `),af.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d,limit:e,orderBy:f}){let g=this.buildWithCTE(d),h=c?af` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,i=b?af` where ${b}`:void 0,j=this.buildOrderBy(f),k=this.buildLimit(e);return af`${g}delete from ${a}${i}${h}${j}${k}`}buildUpdateSet(a,b){let c=a[y.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return af.join(d.flatMap((a,d)=>{let f=c[a],g=f.onUpdateFn?.(),h=b[a]??(l(g,aa)?g:af.param(g,f)),i=af`${af.identifier(this.casing.getColumnCasing(f))} = ${h}`;return d<e-1?[i,af.raw(", ")]:[i]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,joins:f,from:g,limit:h,orderBy:i}){let j=this.buildWithCTE(e),k=this.buildUpdateSet(a,b),l=g&&af.join([af.raw(" from "),this.buildFromTable(g)]),m=this.buildJoins(f),n=d?af` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?af` where ${c}`:void 0,p=this.buildOrderBy(i),q=this.buildLimit(h);return af`${j}update ${a} set ${k}${l}${m}${o}${n}${p}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let e=[];if(l(a,aa.Aliased)&&a.isSelectionField)e.push(af.identifier(a.fieldAlias));else if(l(a,aa.Aliased)||l(a,aa)){let c=l(a,aa.Aliased)?a.sql:a;b?e.push(new aa(c.queryChunks.map(a=>l(a,A)?af.identifier(this.casing.getColumnCasing(a)):a))):e.push(c),l(a,aa.Aliased)&&e.push(af` as ${af.identifier(a.fieldAlias)}`)}else if(l(a,A)){let c=a.table[y.Symbol.Name];"SQLiteNumericBigInt"===a.columnType?b?e.push(af`cast(${af.identifier(this.casing.getColumnCasing(a))} as text)`):e.push(af`cast(${af.identifier(c)}.${af.identifier(this.casing.getColumnCasing(a))} as text)`):b?e.push(af.identifier(this.casing.getColumnCasing(a))):e.push(af`${af.identifier(c)}.${af.identifier(this.casing.getColumnCasing(a))}`)}else if(l(a,V)){let b=Object.entries(a._.selectedFields);if(1===b.length){let c=b[0][1],d=l(c,aa)?c.decoder:l(c,A)?{mapFromDriverValue:a=>c.mapFromDriverValue(a)}:c.sql.decoder;d&&(a._.sql.decoder=d)}e.push(a)}return d<c-1&&e.push(af`, `),e});return af.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];if(a)for(let[c,d]of a.entries()){0===c&&b.push(af` `);let e=d.table,f=d.on?af` on ${d.on}`:void 0;if(l(e,df)){let a=e[df.Symbol.Name],c=e[df.Symbol.Schema],g=e[df.Symbol.OriginalName],h=a===g?void 0:d.alias;b.push(af`${af.raw(d.joinType)} join ${c?af`${af.identifier(c)}.`:void 0}${af.identifier(g)}${h&&af` ${af.identifier(h)}`}${f}`)}else b.push(af`${af.raw(d.joinType)} join ${e}${f}`);c<a.length-1&&b.push(af` `)}return af.join(b)}buildLimit(a){return"object"==typeof a||"number"==typeof a&&a>=0?af` limit ${a}`:void 0}buildOrderBy(a){let b=[];if(a)for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(af`, `);return b.length>0?af` order by ${af.join(b)}`:void 0}buildFromTable(a){return l(a,y)&&a[y.Symbol.IsAlias]?af`${af`${af.identifier(a[y.Symbol.Schema]??"")}.`.if(a[y.Symbol.Schema])}${af.identifier(a[y.Symbol.OriginalName])} ${af.identifier(a[y.Symbol.Name])}`:a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:e,table:f,joins:g,orderBy:h,groupBy:i,limit:j,offset:k,distinct:m,setOperators:n}){let o=c??an(b);for(let a of o){let b;if(l(a.field,A)&&a.field.table[p]!==(l(f,V)?f._.alias:l(f,dh)?f[Y].name:l(f,aa)?void 0:f[p])&&(b=a.field.table,!g?.some(({alias:a})=>a===(b[y.Symbol.IsAlias]?b[p]:b[y.Symbol.BaseName])))){let b=a.field.table[p];throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let q=!g||0===g.length,r=this.buildWithCTE(a),s=m?af` distinct`:void 0,t=this.buildSelection(o,{isSingleTable:q}),u=this.buildFromTable(f),v=this.buildJoins(g),w=d?af` where ${d}`:void 0,x=e?af` having ${e}`:void 0,z=[];if(i)for(let[a,b]of i.entries())z.push(b),a<i.length-1&&z.push(af`, `);let B=z.length>0?af` group by ${af.join(z)}`:void 0,C=this.buildOrderBy(h),D=this.buildLimit(j),E=k?af` offset ${k}`:void 0,F=af`${r}select${s} ${t} from ${u}${v}${w}${B}${x}${C}${D}${E}`;return n.length>0?this.buildSetOperations(F,n):F}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:e,orderBy:f,offset:g}}){let h,i=af`${a.getSQL()} `,j=af`${d.getSQL()}`;if(f&&f.length>0){let a=[];for(let b of f)if(l(b,cH))a.push(af.identifier(b.name));else if(l(b,aa)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];l(c,cH)&&(b.queryChunks[a]=af.identifier(this.casing.getColumnCasing(c)))}a.push(af`${b}`)}else a.push(af`${b}`);h=af` order by ${af.join(a,af`, `)}`}let k="object"==typeof e||"number"==typeof e&&e>=0?af` limit ${e}`:void 0,m=af.raw(`${b} ${c?"all ":""}`),n=g?af` offset ${g}`:void 0;return af`${i}${m}${j}${h}${k}${n}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:e,select:f}){let g=[],h=Object.entries(a[y.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),i=h.map(([,a])=>af.identifier(this.casing.getColumnCasing(a)));if(f)l(b,aa)?g.push(b):g.push(b.getSQL());else for(let[a,c]of(g.push(af.raw("values ")),b.entries())){let d=[];for(let[a,b]of h){let e=c[a];if(void 0===e||l(e,ae)&&void 0===e.value){let a;if(null!==b.default&&void 0!==b.default)a=l(b.default,aa)?b.default:af.param(b.default,b);else if(void 0!==b.defaultFn){let c=b.defaultFn();a=l(c,aa)?c:af.param(c,b)}else if(b.default||void 0===b.onUpdateFn)a=af`null`;else{let c=b.onUpdateFn();a=l(c,aa)?c:af.param(c,b)}d.push(a)}else d.push(e)}g.push(d),a<b.length-1&&g.push(af`, `)}let j=this.buildWithCTE(e),k=af.join(g),m=d?af` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,n=c?.length?af.join(c):void 0;return af`${j}insert into ${a} ${i} ${k}${n}${m}`}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:b})}buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:e,queryConfig:f,tableAlias:g,nestedQueryRelation:h,joinOn:i}){let j,k=[],m,n,o=[],p,q=[];if(!0===f)k=Object.entries(e.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:cp(b,g),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(e.columns).map(([a,b])=>[a,cp(b,g)]));if(f.where){let a="function"==typeof f.where?f.where(d,{and:bX,between:b8,eq:bV,exists:b6,gt:b$,gte:b_,ilike:cc,inArray:b2,isNull:b4,isNotNull:b5,like:ca,lt:b0,lte:b1,ne:bW,not:bZ,notBetween:b9,notExists:b7,notLike:cb,notIlike:cd,notInArray:b3,or:bY,sql:af}):f.where;p=a&&cr(a,g)}let h=[],i=[];if(f.columns){let a=!1;for(let[b,c]of Object.entries(f.columns))void 0!==c&&b in e.columns&&(a||!0!==c||(a=!0),i.push(b));i.length>0&&(i=a?i.filter(a=>f.columns?.[a]===!0):Object.keys(e.columns).filter(a=>!i.includes(a)))}else i=Object.keys(e.columns);for(let a of i){let b=e.columns[a];h.push({tsKey:a,value:b})}let j=[];if(f.with&&(j=Object.entries(f.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:e.relations[a]}))),f.extras)for(let[a,b]of Object.entries("function"==typeof f.extras?f.extras(d,{sql:af}):f.extras))h.push({tsKey:a,value:cq(b,g)});for(let{tsKey:a,value:b}of h)k.push({dbKey:l(b,aa.Aliased)?b.fieldAlias:e.columns[a].name,tsKey:a,field:l(b,A)?cp(b,g):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let q="function"==typeof f.orderBy?f.orderBy(d,{sql:af,asc:ce,desc:cf}):f.orderBy??[];for(let{tsKey:d,queryConfig:e,relation:h}of(Array.isArray(q)||(q=[q]),o=q.map(a=>l(a,A)?cp(a,g):cr(a,g)),m=f.limit,n=f.offset,j)){let f=function(a,b,c){if(l(c,ci)&&c.config)return{fields:c.config.fields,references:c.config.references};let d=b[z(c.referencedTable)];if(!d)throw Error(`Table "${c.referencedTable[y.Symbol.Name]}" not found in schema`);let e=a[d];if(!e)throw Error(`Table "${d}" not found in schema`);let f=c.sourceTable,g=b[z(f)];if(!g)throw Error(`Table "${f[y.Symbol.Name]}" not found in schema`);let h=[];for(let a of Object.values(e.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&h.push(a);if(h.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${d}"`):Error(`There are multiple relations between "${d}" and "${c.sourceTable[y.Symbol.Name]}". Please specify relation name`);if(h[0]&&l(h[0],ci)&&h[0].config)return{fields:h[0].config.references,references:h[0].config.fields};throw Error(`There is not enough information to infer relation "${g}.${c.fieldName}"`)}(b,c,h),i=c[z(h.referencedTable)],j=`${g}_${d}`,m=bX(...f.fields.map((a,b)=>bV(cp(f.references[b],j),cp(a,g)))),n=this.buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:l(h,ci)?!0===e?{limit:1}:{...e,limit:1}:e,tableAlias:j,joinOn:m,nestedQueryRelation:h}),o=af`(${n.sql})`.as(d);k.push({dbKey:d,tsKey:d,field:o,relationTableTsKey:i,isJson:!0,selection:n.selection})}}if(0===k.length)throw new cx({message:`No fields selected for table "${e.tsName}" ("${g}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(p=bX(i,p),h){let a=af`json_array(${af.join(k.map(({field:a})=>l(a,cH)?af.identifier(this.casing.getColumnCasing(a)):l(a,aa.Aliased)?a.sql:a),af`, `)})`;l(h,cj)&&(a=af`coalesce(json_group_array(${a}), json_array())`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:e.tsName,selection:k}];void 0!==m||void 0!==n||o.length>0?(j=this.buildSelectQuery({table:co(d,g),fields:{},fieldsFlat:[{path:[],field:af.raw("*")}],where:p,limit:m,offset:n,orderBy:o,setOperators:[]}),p=void 0,m=void 0,n=void 0,o=void 0):j=co(d,g),j=this.buildSelectQuery({table:l(j,df)?j:new V(j,{},g),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:l(a,A)?cp(a,g):a})),joins:q,where:p,limit:m,offset:n,orderBy:o,setOperators:[]})}else j=this.buildSelectQuery({table:co(d,g),fields:{},fieldsFlat:k.map(({field:a})=>({path:[],field:l(a,A)?cp(a,g):a})),joins:q,where:p,limit:m,offset:n,orderBy:o,setOperators:[]});return{tableTsKey:e.tsName,sql:j,selection:k}}}class dj extends di{static [k]="SQLiteSyncDialect";migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=af`
			CREATE TABLE IF NOT EXISTS ${af.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;b.run(e);let f=b.values(af`SELECT id, hash, created_at FROM ${af.identifier(d)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;b.run(af`BEGIN`);try{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)b.run(af.raw(a));b.run(af`INSERT INTO ${af.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}b.run(af`COMMIT`)}catch(a){throw b.run(af`ROLLBACK`),a}}}class dk extends di{static [k]="SQLiteAsyncDialect";async migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=af`
			CREATE TABLE IF NOT EXISTS ${af.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await b.run(e);let f=(await b.values(af`SELECT id, hash, created_at FROM ${af.identifier(d)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await b.transaction(async b=>{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)await b.run(af.raw(a));await b.run(af`INSERT INTO ${af.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class dl{static [k]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class dm{static [k]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}class dn{constructor(a,b){this.name=a,this.value=b}static [k]="SQLiteCheckBuilder";brand;build(a){return new dp(a,this)}}class dp{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [k]="SQLiteCheck";name;value}class dq{constructor(a,b){this.name=a,this.unique=b}static [k]="SQLiteIndexBuilderOn";on(...a){return new dr(this.name,a,this.unique)}}class dr{static [k]="SQLiteIndexBuilder";config;constructor(a,b,c){this.config={name:a,columns:b,unique:c,where:void 0}}where(a){return this.config.where=a,this}build(a){return new ds(this.config,a)}}class ds{static [k]="SQLiteIndex";config;constructor(a,b){this.config={...a,table:b}}}class dt{static [k]="SQLitePrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new du(a,this.columns,this.name)}}class du{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [k]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[df.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}function dv(a){return l(a,df)?[`${a[y.Symbol.BaseName]}`]:l(a,V)?a._.usedTables??[]:l(a,aa)?a.usedTables??[]:[]}class dw{static [k]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,this.withList=a.withList,this.distinct=a.distinct}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:l(a,V)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):l(a,dh)?a[Y].selectedFields:l(a,aa)?{}:a[y.Symbol.Columns],new dy({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class dx extends dl{static [k]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=aq(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},dv(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a){return(b,c)=>{let d=this.tableName,e=aq(b);for(let a of dv(b))this.usedTables.add(a);if("string"==typeof e&&this.config.joins?.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof d&&(this.config.fields={[d]:this.config.fields}),"string"==typeof e&&!l(b,aa))){let a=l(b,V)?b._.selectedFields:l(b,al)?b[Y].selectedFields:b[y.Symbol.Columns];this.config.fields[e]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new cs({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:e}),"string"==typeof e)switch(a){case"left":this.joinsNotNullableMap[e]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[e]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(dA()):c;if(!ao(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new cs({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new cs({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new cs({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new cs({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...dv(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...dv(a.table));return new Proxy(new V(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new cs({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new cs({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class dy extends dx{static [k]="SQLiteSelect";_prepare(a=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let b=an(this.config.fields),c=this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),b,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return c.joinsNotNullableMap=this.joinsNotNullableMap,c}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.all()}}for(let a of[dm])for(let b of Object.getOwnPropertyNames(a.prototype))"constructor"!==b&&Object.defineProperty(dy.prototype,b,Object.getOwnPropertyDescriptor(a.prototype,b)||Object.create(null));function dz(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!ao(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}let dA=()=>({union:dB,unionAll:dC,intersect:dD,except:dE}),dB=dz("union",!1),dC=dz("union",!0),dD=dz("intersect",!1),dE=dz("except",!1);class dF{static [k]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=l(a,di)?a:void 0,this.dialectConfig=l(a,di)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new W(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new cs({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new dw({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(c){return new dw({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a,distinct:!0})}}}select(a){return new dw({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new dw({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new dj(this.dialectConfig)),this.dialect}}class dG extends dm{constructor(a,b,c,d){super(),this.table=a,this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [k]="SQLiteDelete";config;where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[y.Symbol.Columns],new cs({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.table[df.Symbol.Columns]){return this.config.returning=an(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:dv(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(a){return this._prepare().execute(a)}$dynamic(){return this}}class dH{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [k]="SQLiteInsertBuilder";values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[y.Symbol.Columns];for(let d of Object.keys(a)){let e=a[d];b[d]=l(e,aa)?e:new ae(e,c[d])}return b});return new dI(this.table,b,this.session,this.dialect,this.withList)}select(a){let b="function"==typeof a?a(new dF):a;if(!l(b,aa)&&!ao(this.table[r],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new dI(this.table,b,this.session,this.dialect,this.withList,!0)}}class dI extends dm{constructor(a,b,c,d,e,f){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f}}static [k]="SQLiteInsert";config;returning(a=this.config.table[df.Symbol.Columns]){return this.config.returning=an(a),this}onConflictDoNothing(a={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===a.target)this.config.onConflict.push(af` on conflict do nothing`);else{let b=Array.isArray(a.target)?af`${a.target}`:af`${[a.target]}`,c=a.where?af` where ${a.where}`:af``;this.config.onConflict.push(af` on conflict ${b} do nothing${c}`)}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let b=a.where?af` where ${a.where}`:void 0,c=a.targetWhere?af` where ${a.targetWhere}`:void 0,d=a.setWhere?af` where ${a.setWhere}`:void 0,e=Array.isArray(a.target)?af`${a.target}`:af`${[a.target]}`,f=this.dialect.buildUpdateSet(this.config.table,ap(this.config.table,a.set));return this.config.onConflict.push(af` on conflict ${e}${c} do update set ${f}${b}${d}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:dv(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class dJ{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [k]="SQLiteUpdateBuilder";set(a){return new dK(this.table,ap(this.table,a),this.session,this.dialect,this.withList)}}class dK extends dm{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]}}static [k]="SQLiteUpdate";config;from(a){return this.config.from=a,this}createJoin(a){return(b,c)=>{let d=aq(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from?l(b,df)?b[y.Symbol.Columns]:l(b,V)?b._.selectedFields:l(b,dh)?b[Y].selectedFields:void 0:void 0;c=c(new Proxy(this.config.table[y.Symbol.Columns],new cs({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new cs({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:c,table:b,joinType:a,alias:d}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[y.Symbol.Columns],new cs({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.config.table[df.Symbol.Columns]){return this.config.returning=an(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:dv(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class dL extends aa{constructor(a){super(dL.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.session=a.session,this.sql=dL.buildCount(a.source,a.filters)}sql;static [k]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(a,b){return af`(select count(*) from ${a}${af.raw(" where ").if(b)}${b})`}static buildCount(a,b){return af`select count(*) from ${a}${af.raw(" where ").if(b)}${b}`}then(a,b){return Promise.resolve(this.session.count(this.sql)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class dM{constructor(a,b,c,d,e,f,g,h){this.mode=a,this.fullSchema=b,this.schema=c,this.tableNamesMap=d,this.table=e,this.tableConfig=f,this.dialect=g,this.session=h}static [k]="SQLiteAsyncRelationalQueryBuilder";findMany(a){return"sync"===this.mode?new dO(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many"):new dN(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return"sync"===this.mode?new dO(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first"):new dN(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class dN extends dm{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [k]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(a=!1){let{query:b,builtQuery:c}=this._toSQL();return this.session[a?"prepareOneTimeQuery":"prepareQuery"](c,void 0,"first"===this.mode?"get":"all",!0,(a,c)=>{let d=a.map(a=>(function a(b,c,d,e,f=a=>a){let g={};for(let[h,i]of e.entries())if(i.isJson){let e=c.relations[i.tsKey],j=d[h],k="string"==typeof j?JSON.parse(j):j;g[i.tsKey]=l(e,ci)?k&&a(b,b[i.relationTableTsKey],k,i.selection,f):k.map(c=>a(b,b[i.relationTableTsKey],c,i.selection,f))}else{let a,b=f(d[h]),c=i.field;a=l(c,A)?c:l(c,aa)?c.decoder:c.sql.decoder,g[i.tsKey]=null===b?null:a.mapFromDriverValue(b)}return g})(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})}prepare(){return this._prepare(!1)}_toSQL(){let a=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class dO extends dN{static [k]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class dP extends dm{constructor(a,b,c,d,e){super(),this.execute=a,this.getSQL=b,this.dialect=d,this.mapBatchResult=e,this.config={action:c}}static [k]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class dQ{constructor(a,b,c,d){this.resultKind=a,this.dialect=b,this.session=c,this._=d?{schema:d.schema,fullSchema:d.fullSchema,tableNamesMap:d.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};const e=this.query;if(this._.schema)for(const[f,g]of Object.entries(this._.schema))e[f]=new dM(a,d.fullSchema,this._.schema,this._.tableNamesMap,d.fullSchema[f],g,b,c);this.$cache={invalidate:async a=>{}}}static [k]="BaseSQLiteDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new dF(c.dialect))),new Proxy(new W(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new cs({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new dL({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new dw({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new dw({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},update:function(c){return new dJ(c,b.session,b.dialect,a)},insert:function(c){return new dH(c,b.session,b.dialect,a)},delete:function(c){return new dG(c,b.session,b.dialect,a)}}}select(a){return new dw({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new dw({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(a){return new dJ(a,this.session,this.dialect)}$cache;insert(a){return new dH(a,this.session,this.dialect)}delete(a){return new dG(a,this.session,this.dialect)}run(a){let b="string"==typeof a?af.raw(a):a.getSQL();return"async"===this.resultKind?new dP(async()=>this.session.run(b),()=>b,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(b)}all(a){let b="string"==typeof a?af.raw(a):a.getSQL();return"async"===this.resultKind?new dP(async()=>this.session.all(b),()=>b,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(b)}get(a){let b="string"==typeof a?af.raw(a):a.getSQL();return"async"===this.resultKind?new dP(async()=>this.session.get(b),()=>b,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(b)}values(a){let b="string"==typeof a?af.raw(a):a.getSQL();return"async"===this.resultKind?new dP(async()=>this.session.values(b),()=>b,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(b)}transaction(a,b){return this.session.transaction(a,b)}}class dR{static [k]="Cache"}class dS extends dR{strategy(){return"all"}static [k]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function dT(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class dU extends dm{constructor(a){super(),this.resultCb=a}static [k]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class dV{constructor(a,b,c,d,e,f){this.mode=a,this.executeMethod=b,this.query=c,this.cache=d,this.queryMetadata=e,this.cacheConfig=f,d&&"all"===d.strategy()&&void 0===f&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static [k]="PreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||l(this.cache,dS)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new cy(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new cy(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new cy(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await dT(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new cy(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await dT(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new cy(a,b,c)}}getQuery(){return this.query}mapRunResult(a,b){return a}mapAllResult(a,b){throw Error("Not implemented")}mapGetResult(a,b){throw Error("Not implemented")}execute(a){return"async"===this.mode?this[this.executeMethod](a):new dU(()=>this[this.executeMethod](a))}mapResult(a,b){switch(this.executeMethod){case"run":return this.mapRunResult(a,b);case"all":return this.mapAllResult(a,b);case"get":return this.mapGetResult(a,b)}}}class dW{constructor(a){this.dialect=a}static [k]="SQLiteSession";prepareOneTimeQuery(a,b,c,d,e,f,g){return this.prepareQuery(a,b,c,d,e,f,g)}run(a){let b=this.dialect.sqlToQuery(a);try{return this.prepareOneTimeQuery(b,void 0,"run",!1).run()}catch(a){throw new cx({cause:a,message:`Failed to run the query '${b.sql}'`})}}extractRawRunValueFromBatchResult(a){return a}all(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(a){throw Error("Not implemented")}get(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(a){throw Error("Not implemented")}values(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).values()}async count(a){return(await this.values(a))[0][0]}extractRawValuesValueFromBatchResult(a){throw Error("Not implemented")}}class dX extends dQ{constructor(a,b,c,d,e=0){super(a,b,c,d),this.schema=d,this.nestedIndex=e}static [k]="SQLiteTransaction";rollback(){throw new cz}}class dY extends dW{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new o,this.cache=d.cache??new dS}static [k]="SQLiteD1Session";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new d_(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();if(b.push(a),e.params.length>0)c.push(a.stmt.bind(...e.params));else{let b=a.getQuery();c.push(this.client.prepare(b.sql).bind(...b.params))}}return(await this.client.batch(c)).map((a,c)=>b[c].mapResult(a,!0))}extractRawAllValueFromBatchResult(a){return a.results}extractRawGetValueFromBatchResult(a){return a.results[0]}extractRawValuesValueFromBatchResult(a){return d$(a.results)}async transaction(a,b){let c=new dZ("async",this.dialect,this,this.schema);await this.run(af.raw(`begin${b?.behavior?" "+b.behavior:""}`));try{let b=await a(c);return await this.run(af`commit`),b}catch(a){throw await this.run(af`rollback`),a}}}class dZ extends dX{static [k]="D1Transaction";async transaction(a){let b=`sp${this.nestedIndex}`,c=new dZ("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(af.raw(`savepoint ${b}`));try{let d=await a(c);return await this.session.run(af.raw(`release savepoint ${b}`)),d}catch(a){throw await this.session.run(af.raw(`rollback to savepoint ${b}`)),a}}}function d$(a){let b=[];for(let c of a){let a=Object.keys(c).map(a=>c[a]);b.push(a)}return b}class d_ extends dV{constructor(a,b,c,d,e,f,g,h,i,j){super("async",h,b,d,e,f),this.logger=c,this._isResponseInArrayMode=i,this.customResultMapper=j,this.fields=g,this.stmt=a}static [k]="D1PreparedQuery";customResultMapper;fields;stmt;async run(a){let b=aj(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).run())}async all(a){let{fields:b,query:c,logger:d,stmt:e,customResultMapper:f}=this;if(!b&&!f){let b=aj(c.params,a??{});return d.logQuery(c.sql,b),await this.queryWithCache(c.sql,b,async()=>e.bind(...b).all().then(({results:a})=>this.mapAllResult(a)))}let g=await this.values(a);return this.mapAllResult(g)}mapAllResult(a,b){return(b&&(a=d$(a.results)),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper(a):a.map(a=>am(this.fields,a,this.joinsNotNullableMap)):a}async get(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=aj(d.params,a??{});return e.logQuery(d.sql,b),await this.queryWithCache(d.sql,b,async()=>f.bind(...b).all().then(({results:a})=>a[0]))}let h=await this.values(a);if(h[0])return g?g(h):am(b,h[0],c)}mapGetResult(a,b){return(b&&(a=d$(a.results)[0]),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper([a]):am(this.fields,a,this.joinsNotNullableMap):a}async values(a){let b=aj(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).raw())}isResponseInArrayMode(){return this._isResponseInArrayMode}}class d0 extends dQ{static [k]="D1Database";async batch(a){return this.session.batch(a)}}let d1=dg("characters",{id:c$("id").primaryKey({autoIncrement:!0}),name:dd("name").notNull().unique(),slug:dd("slug").notNull(),imageUrl:dd("image_url").notNull(),nameImage:dd("name_image")}),d2=dg("votes",{id:c$("id").primaryKey({autoIncrement:!0}),characterId:c$("character_id").references(()=>d1.id).notNull(),tier:dd("tier").notNull(),patch:dd("patch").notNull().default("unknown"),sessionId:dd("session_id").notNull(),ipHash:dd("ip_hash").notNull().default("legacy"),createdAt:c$("created_at",{mode:"timestamp"}).default(new Date)},a=>({unq:new cE(void 0).on(a.characterId,a.ipHash,a.patch)}));a.s(["characters",0,d1,"votes",0,d2],37137);var d3=a.i(37137);async function d4(){let{env:a}=await function(a={async:!1}){return a.async?i():function(){let a,b=h();if(b)return b;if(a=globalThis,a.__NEXT_DATA__?.nextExport===!0)throw Error("\n\nERROR: `getCloudflareContext` has been called in sync mode in either a static route or at the top level of a non-static one, both cases are not allowed but can be solved by either:\n  - make sure that the call is not at the top level and that the route is not static\n  - call `getCloudflareContext({async: true})` to use the `async` mode\n  - avoid calling `getCloudflareContext` in the route\n");throw Error('\n\nERROR: `getCloudflareContext` has been called without having called `initOpenNextCloudflareForDev` from the Next.js config file.\nYou should update your Next.js config file as shown below:\n\n   ```\n   // next.config.mjs\n\n   import { initOpenNextCloudflareForDev } from "@opennextjs/cloudflare";\n\n   initOpenNextCloudflareForDev();\n\n   const nextConfig = { ... };\n   export default nextConfig;\n   ```\n\n')}()}();return function(a,b={}){let c,d,e=new dk({casing:b.casing});if(!0===b.logger?c=new n:!1!==b.logger&&(c=b.logger),b.schema){let a=function(a,b){1===Object.keys(a).length&&"default"in a&&!l(a.default,y)&&(a=a.default);let c={},d={},e={};for(let[f,g]of Object.entries(a))if(l(g,y)){let a=z(g),b=d[a];for(let d of(c[a]=f,e[f]={tsName:f,dbName:g[y.Symbol.Name],schema:g[y.Symbol.Schema],columns:g[y.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(g[y.Symbol.Columns])))d.primary&&e[f].primaryKey.push(d);let h=g[y.Symbol.ExtraConfigBuilder]?.(g[y.Symbol.ExtraConfigColumns]);if(h)for(let a of Object.values(h))l(a,bS)&&e[f].primaryKey.push(...a.columns)}else if(l(g,ch)){let a,f=z(g.table),h=c[f];for(let[c,i]of Object.entries(g.config(b(g.table))))if(h){let b=e[h];b.relations[c]=i,a&&b.primaryKey.push(...a)}else f in d||(d[f]={relations:{},primaryKey:a}),d[f].relations[c]=i}return{tables:e,tableNamesMap:c}}(b.schema,ck);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let f=new dY(a,e,d,{logger:c,cache:b.cache}),g=new d0("async",e,f,d);return g.$client=a,g.$cache=b.cache,g.$cache&&(g.$cache.invalidate=b.cache?.onMutate),g}(a.deadlock_tier_list_db,{schema:d3})}async function d5(){try{let a=await fetch("https://assets.deadlock-api.com/v2/client-versions",{next:{revalidate:3600}});if(!a.ok)return[];return(await a.json()).map(Number).sort((a,b)=>b-a)}catch(a){return console.error("Failed to fetch patches:",a),[]}}let d6={S:6,A:5,B:4,C:3,D:2,F:1},d7={6:"S",5:"A",4:"B",3:"C",2:"D",1:"F"};async function d8(a,b){let c=await d5(),d=c.length>0?c[0].toString():"unknown",e=a||d,f=await d4(),g=await f.select().from(d1),h=await f.select({character_id:d2.characterId,tier:d2.tier,count:af`count(*)`}).from(d2).where(bV(d2.patch,e)).groupBy(d2.characterId,d2.tier),i={};for(let a of g)i[a.id]={totalScore:0,totalVotes:0};for(let a of h){let b=a.character_id,c=a.tier,d=Number(a.count);i[b]&&d6[c]&&(i[b].totalScore+=d6[c]*d,i[b].totalVotes+=d)}let j={};if(b)for(let a of(await f.select({character_id:d2.characterId,tier:d2.tier}).from(d2).where(bX(bV(d2.sessionId,b),bV(d2.patch,e)))))j[a.character_id]=a.tier;return{tierList:g.map(a=>{let b=i[a.id],c="N/A";return b.totalVotes>0&&(c=d7[Math.round(b.totalScore/b.totalVotes)]||"C"),{...a,averageTier:c,totalVotes:b.totalVotes,userVote:j[a.id]||null}}),metadata:{currentPatch:e,latestPatch:d,allPatches:c,isLatest:e===d}}}async function d9(){let{tierList:a,metadata:b}=await d8();return(0,e.jsx)("main",{className:"min-h-screen py-12",children:(0,e.jsx)(f.default,{initialData:a,initialMeta:b})})}a.s(["default",()=>d9,"dynamic",0,"force-dynamic"],60168)}];

//# sourceMappingURL=src_ec744ad0._.js.map